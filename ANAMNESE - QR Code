<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema M√©dico QR Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">üè• Sistema de Identifica√ß√£o e Anamnese via QR-CODE</h1>
            <p class="text-gray-600">Gerenciamento seguro de dados m√©dicos com QR Code</p>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-lg p-2 flex space-x-2">
                <button onclick="showSection('cadastro')" id="btn-cadastro" class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 bg-indigo-600 text-white">
                    üìù Cadastrar Paciente
                </button>
                <button onclick="showSection('lista')" id="btn-lista" class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-indigo-600 hover:bg-indigo-50">
                    üìã Lista de Pacientes
                </button>
                <button onclick="showSection('leitor')" id="btn-leitor" class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 text-indigo-600 hover:bg-indigo-50">
                    üì± Ler QR Code
                </button>
            </div>
        </div>

        <!-- Se√ß√£o Cadastro -->
        <div id="section-cadastro" class="section">
            <div class="bg-white rounded-xl shadow-xl p-8 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-indigo-100 p-2 rounded-lg mr-3">üë§</span>
                    Cadastro de Paciente
                </h2>
                
                <form id="patientForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Dados Pessoais -->
                    <div class="md:col-span-2">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">üìã Dados Pessoais</h3>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo *</label>
                        <input type="text" id="nome" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data de Nascimento *</label>
                        <input type="date" id="nascimento" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sexo biol√≥gico *</label>
                        <select id="tipoPaciente" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Selecione...</option>
                            <option value="idoso">Masculino</option>
                            <option value="deficiencia">Feminino</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Estado Civil *</label>
                        <select id="tipoPaciente" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Selecione...</option>
                            <option value="idoso">Solteiro</option>
                            <option value="deficiencia">Casado</option>
                            <option value="cronica">Uni√£o Est√°vel</option>
                            <option value="rara">Separado</option>
                            <option value="outros">Divorciado</option>
                            <option value="outros">Vi√∫vo</option>
                            <option value="outros">Prefiro n√£o informar</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Naturalidade *</label>
                        
                            <select id="estado" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onchange="carregarCidades()">
                            <option value="">-- Selecione um Estado --</option>
                          </select>

                          <br><br>
                            
                            <select id="cidade" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" disabled>
                                <option value="">-- Selecione uma Cidade --</option>
                         </select>

                        <script>
                            const estadoSelect = document.getElementById("estado");
                            const cidadeSelect = document.getElementById("cidade");

                        // Carrega todos os estados ao abrir a p√°gina
                        fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome")
                          .then(res => res.json())
                          .then(estados => {
                        estados.forEach(estado => {
                          const option = document.createElement("option");
                          option.value = estado.sigla;
                          option.text = `${estado.nome} (${estado.sigla})`;
                          estadoSelect.add(option);
        });
      });

                       // Carrega cidades do estado selecionado
                       function carregarCidades() {
                          const uf = estadoSelect.value;
                          cidadeSelect.innerHTML = "<option value=''>-- Selecione uma Cidade --</option>";
                          cidadeSelect.disabled = true;

                      if (!uf) return;

                      fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${uf}/municipios`)
                        .then(res => res.json())
                        .then(cidades => {
                      cidades.forEach(cidade => {
                        const option = document.createElement("option");
                        option.value = cidade.nome;
                        option.text = cidade.nome;
                        cidadeSelect.add(option);
                          });
                      cidadeSelect.disabled = false;
                      });
    }
  </script>
                    </div>
                <div>
  <h2>Endere√ßo</h2>

  <label for="cep" "block text-sm font-medium text-gray-700 mb-2">CEP</label>
  <input type="text" id="cep" maxlength="9" onblur="buscarEndereco()" placeholder="00000-000">

  <label for="logradouro">Rua</label>
  <input type="text" id="logradouro" readonly>

  <label for="numero">N√∫mero</label>
  <input type="text" id="numero" placeholder="Ex: 123">

  <label for="complemento">Complemento</label>
  <input type="text" id="complemento" placeholder="Ex: Apt 201, Bloco B">

  <label for="bairro">Bairro</label>
  <input type="text" id="bairro" readonly>

  <label for="cidade">Cidade</label>
  <input type="text" id="localidade" readonly>

  <label for="uf">Estado</label>
  <input type="text" id="uf" readonly>

  <label for="referencia">Ponto de Refer√™ncia</label>
  <input type="text" id="referencia" placeholder="Ex: Pr√≥ximo ao supermercado X">

  <script>
    function buscarEndereco() {
      const cep = document.getElementById("cep").value.replace(/\D/g, '');

      if (cep.length !== 8) {
        alert("CEP inv√°lido");
        return;
      }

      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => {
          if (data.erro) {
            alert("CEP n√£o encontrado.");
            return;
          }

          document.getElementById("logradouro").value = data.logradouro || "";
          document.getElementById("bairro").value = data.bairro || "";
          document.getElementById("localidade").value = data.localidade || "";
          document.getElementById("uf").value = data.uf || "";
        })
        .catch(() => alert("Erro ao buscar o endere√ßo."));
    }
  </script>
 <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Profiss√£o</label>
                        <input type="text" id="nome" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
 </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Op√ß√£o sexual *</label>
                        <select id="tipoPaciente" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Selecione...</option>
                            <option value="idoso">H√©terosexual</option>
                            <option value="deficiencia">Homosexual</option>
                            <option value="cronica">Transexual</option>
                            <option value="rara">Bissexal</option>
                            <option value="outros">Assexual</option>
                            <option value="outros">Pansexual</option>
                            <option value="outros">Prefiro n√£o informar</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">CPF *</label>
                        <input type="text" id="cpf" required placeholder="000.000.000-00" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contato *</label>
                        <input type="tel" id="telefone" required placeholder="(11) 99999-9999" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contato para emerg√™ncias *</label>
                        <input type="text" id="nome" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone de Emerg√™ncia *</label>
                        <input type="tel" id="telefone" required placeholder="(11) 99999-9999" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Paciente *</label>
                        <select id="tipoPaciente" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Selecione...</option>
                            <option value="idoso">üë¥ Idoso</option>
                            <option value="deficiencia">‚ôø Pessoa com Defici√™ncia</option>
                            <option value="cronica">üè• Doen√ßa Cr√¥nica</option>
                            <option value="rara">üî¨ Doen√ßa Rara</option>
                            <option value="outros">üìã Outros</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo Sangu√≠neo *</label>
                        <select id="tipoSanguineo" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">Selecione...</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>

                    <!-- Dados M√©dicos -->
                    <div class="md:col-span-2 mt-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">üè• Informa√ß√µes M√©dicas</h3>
                    </div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Medicamentos em uso</label>
                           <ul id="lista-itens">
                              
  </ul>

 <ul id="lista-itens">
 
  </ul>

  <h3>Adicionar nova medica√ß√£o</h3>
  <input type="text" id="item-nome" placeholder="Nome a medica√ß√£o" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"/>
  <input type="number" id="item-quantidade" placeholder="Unidades ou ml" min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"/>
  <input type="number" id="item-peso" placeholder="mg por unidade" min="0,1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"/>
  <button onclick="adicionarItem()" class="w-full px-4 py-3 border border-gray-300 bg-gray-300 text-black rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">Adicionar</button>

  <script>
    function adicionarItem() {
      const nome = document.getElementById('item-nome').value.trim();
      const quantidade = document.getElementById('item-quantidade').value.trim();
      const peso = document.getElementById('item-peso').value.trim();

      if (nome && quantidade && peso) {
        const lista = document.getElementById('lista-itens');
        const novoItem = document.createElement('li');

        const totalPeso = Number(quantidade) * Number(peso);
        novoItem.textContent = `${nome} - ${quantidade} ${quantidade == 1 ? 'unidade' : 'unidades/ml'} - ${totalPeso} mg`;
        lista.appendChild(novoItem);

        // Limpar os campos ap√≥s adicionar
        document.getElementById('item-nome').value = '';
        document.getElementById('item-quantidade').value = '';
        document.getElementById('item-peso').value = '';
      } else {
        alert('Por favor, preencha todos os campos: nome, quantidade e peso.');
      }
    }
  </script>

                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hist√≥rico familiar (Doen√ßas prevalentes na fam√≠lia, incluindo pais, irm√£os e filhos)</label>
                        <textarea id="condicoes" rows="3" placeholder="Diabetes, Hipertens√£o, Alzheimer, C√¢ncer, etc." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Medicamentos em Uso</label>
                        <textarea id="medicamentos" rows="3" placeholder="Lista de medicamentos e dosagens" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Alergias</label>
                        <textarea id="alergias" rows="2" placeholder="Alergias medicamentosas, alimentares, etc." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">M√©dico Respons√°vel</label>
                        <input type="text" id="medico" placeholder="Dr. Jo√£o Silva - CRM 12345" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contato do M√©dico</label>
                        <input type="text" id="contatoEmergencia" placeholder="Nome e telefone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes Especiais</label>
                        <textarea id="observacoes" rows="2" placeholder="Informa√ß√µes importantes para emerg√™ncias" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Informa√ß√µes com * s√£o obrigat√≥rias</label>
                    </div>

                    <div class="md:col-span-2 mt-6">
                        <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                            üíæ Cadastrar e Gerar QR Code
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o Lista -->
        <div id="section-lista" class="section hidden">
            <div class="bg-white rounded-xl shadow-xl p-8 max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <span class="bg-indigo-100 p-2 rounded-lg mr-3">üìã</span>
                        Lista de Pacientes
                    </h2>
                    <div class="text-sm text-gray-600">
                        Total: <span id="totalPacientes" class="font-bold text-indigo-600">0</span> pacientes
                    </div>
                </div>
                
                <!-- Filtros -->
                <div class="mb-6 flex flex-wrap gap-4">
                    <select id="filtroTipo" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="">Todos os tipos</option>
                        <option value="idoso">üë¥ Idosos</option>
                        <option value="deficiencia">‚ôø Pessoas com Defici√™ncia</option>
                        <option value="cronica">üè• Doen√ßas Cr√¥nicas</option>
                        <option value="rara">üî¨ Doen√ßas Raras</option>
                        <option value="outros">üìã Outros</option>
                    </select>
                    <input type="text" id="buscaNome" placeholder="Buscar por nome..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>
                
                <div id="listaPacientes" class="space-y-4">
                    <!-- Lista ser√° preenchida dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Se√ß√£o Leitor QR -->
        <div id="section-leitor" class="section hidden">
            <div class="bg-white rounded-xl shadow-xl p-8 max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="bg-indigo-100 p-2 rounded-lg mr-3">üì±</span>
                    Leitor de QR Code
                </h2>
                
                <div class="text-center">
                    <div class="bg-gray-100 rounded-lg p-8 mb-6">
                        <div class="text-6xl mb-4">üì±</div>
                        <p class="text-gray-600 mb-4">Cole o c√≥digo QR ou dados do paciente aqui:</p>
                        <textarea id="qrInput" rows="6" placeholder="Cole os dados do QR Code aqui..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                        <button onclick="lerQRCode()" class="mt-4 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                            üîç Ler Dados
                        </button>
                    </div>
                    
                    <div id="dadosLidos" class="hidden">
                        <!-- Dados do QR ser√£o exibidos aqui -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal QR Code -->
        <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-xl p-8 max-w-md mx-4">
                <div class="text-center">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">QR Code Gerado</h3>
                    <div id="qrCodeContainer" class="mb-4"></div>
                    <p class="text-sm text-gray-600 mb-4">Salve ou imprima este QR Code</p>
                    <div class="flex space-x-4">
                        <button onclick="downloadQR()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            üíæ Baixar
                        </button>
                        <button onclick="closeModal()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            ‚úñÔ∏è Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados dos pacientes (simulando banco de dados local)
        let pacientes = JSON.parse(localStorage.getItem('pacientesMedicos')) || [];
        let currentQRData = '';

        // Dados de exemplo para demonstra√ß√£o
        if (pacientes.length === 0) {
            const exemplosPacientes = [
                {
                    id: 1,
                    nome: "Maria Silva Santos",
                    nascimento: "1945-03-15",
                    cpf: "123.456.789-00",
                    telefone: "(11) 99999-1111",
                    tipoPaciente: "idoso",
                    tipoSanguineo: "O+",
                    condicoes: "Diabetes tipo 2, Hipertens√£o arterial, Artrose",
                    medicamentos: "Metformina 850mg 2x/dia, Losartana 50mg 1x/dia, Paracetamol conforme necess√°rio",
                    alergias: "Penicilina, Dipirona",
                    medico: "Dr. Jo√£o Cardiologista - CRM 12345-SP",
                    contatoEmergencia: "Filho: Pedro Santos (11) 98888-2222",
                    observacoes: "Paciente com mobilidade reduzida, usa bengala"
                },
                {
                    id: 2,
                    nome: "Carlos Eduardo Lima",
                    nascimento: "1980-07-22",
                    cpf: "987.654.321-00",
                    telefone: "(11) 97777-3333",
                    tipoPaciente: "deficiencia",
                    tipoSanguineo: "A+",
                    condicoes: "Paraplegia, Infec√ß√£o urin√°ria recorrente",
                    medicamentos: "Antibi√≥tico profil√°tico, Vitamina D",
                    alergias: "Nenhuma conhecida",
                    medico: "Dra. Ana Neurologista - CRM 54321-SP",
                    contatoEmergencia: "Esposa: Lucia Lima (11) 96666-4444",
                    observacoes: "Cadeirante, necessita acessibilidade"
                },
                {
                    id: 3,
                    nome: "Ana Paula Oliveira",
                    nascimento: "1975-11-08",
                    cpf: "456.789.123-00",
                    telefone: "(11) 95555-5555",
                    tipoPaciente: "rara",
                    tipoSanguineo: "B-",
                    condicoes: "S√≠ndrome de Ehlers-Danlos",
                    medicamentos: "Analg√©sicos, Fisioterapia regular",
                    alergias: "L√°tex, Aspirina",
                    medico: "Dr. Roberto Geneticista - CRM 98765-SP",
                    contatoEmergencia: "M√£e: Rosa Oliveira (11) 94444-6666",
                    observacoes: "Pele muito fr√°gil, evitar procedimentos invasivos"
                }
            ];
            
            pacientes = exemplosPacientes;
            localStorage.setItem('pacientesMedicos', JSON.stringify(pacientes));
        }

        // Navega√ß√£o entre se√ß√µes
        function showSection(section) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Mostrar se√ß√£o selecionada
            document.getElementById(`section-${section}`).classList.remove('hidden');
            document.getElementById(`section-${section}`).classList.add('fade-in');
            
            // Atualizar bot√µes
            document.querySelectorAll('button[id^="btn-"]').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('text-indigo-600', 'hover:bg-indigo-50');
            });
            
            document.getElementById(`btn-${section}`).classList.add('bg-indigo-600', 'text-white');
            document.getElementById(`btn-${section}`).classList.remove('text-indigo-600', 'hover:bg-indigo-50');
            
            // Atualizar lista se necess√°rio
            if (section === 'lista') {
                atualizarLista();
            }
        }

        // Formata√ß√£o de CPF
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        // Formata√ß√£o de telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Cadastro de paciente
        document.getElementById('patientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const paciente = {
                id: Date.now(),
                nome: document.getElementById('nome').value,
                nascimento: document.getElementById('nascimento').value,
                cpf: document.getElementById('cpf').value,
                telefone: document.getElementById('telefone').value,
                tipoPaciente: document.getElementById('tipoPaciente').value,
                tipoSanguineo: document.getElementById('tipoSanguineo').value,
                condicoes: document.getElementById('condicoes').value,
                medicamentos: document.getElementById('medicamentos').value,
                alergias: document.getElementById('alergias').value,
                medico: document.getElementById('medico').value,
                contatoEmergencia: document.getElementById('contatoEmergencia').value,
                observacoes: document.getElementById('observacoes').value,
                dataCadastro: new Date().toISOString()
            };
            
            pacientes.push(paciente);
            localStorage.setItem('pacientesMedicos', JSON.stringify(pacientes));
            
            // Gerar QR Code
            gerarQRCode(paciente);
            
            // Limpar formul√°rio
            document.getElementById('patientForm').reset();
            
            // Mostrar mensagem de sucesso
            alert('‚úÖ Paciente cadastrado com sucesso! QR Code gerado.');
        });

        // Gerar QR Code
        function gerarQRCode(paciente) {
            const qrData = JSON.stringify({
                nome: paciente.nome,
                nascimento: paciente.nascimento,
                tipoPaciente: paciente.tipoPaciente,
                tipoSanguineo: paciente.tipoSanguineo,
                condicoes: paciente.condicoes,
                medicamentos: paciente.medicamentos,
                alergias: paciente.alergias,
                medico: paciente.medico,
                contatoEmergencia: paciente.contatoEmergencia,
                telefone: paciente.telefone,
                observacoes: paciente.observacoes
            });
            
            currentQRData = qrData;
            
            const container = document.getElementById('qrCodeContainer');
            container.innerHTML = '';
            
            QRCode.toCanvas(container, qrData, {
                width: 256,
                margin: 2,
                color: {
                    dark: '#1f2937',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) console.error(error);
                document.getElementById('qrModal').classList.remove('hidden');
                document.getElementById('qrModal').classList.add('flex');
            });
        }

        // Download QR Code
        function downloadQR() {
            const canvas = document.querySelector('#qrCodeContainer canvas');
            const link = document.createElement('a');
            link.download = 'qr-code-medico.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Fechar modal
        function closeModal() {
            document.getElementById('qrModal').classList.add('hidden');
            document.getElementById('qrModal').classList.remove('flex');
        }

        // Atualizar lista de pacientes
        function atualizarLista() {
            const lista = document.getElementById('listaPacientes');
            const filtroTipo = document.getElementById('filtroTipo').value;
            const buscaNome = document.getElementById('buscaNome').value.toLowerCase();
            
            let pacientesFiltrados = pacientes.filter(p => {
                const matchTipo = !filtroTipo || p.tipoPaciente === filtroTipo;
                const matchNome = !buscaNome || p.nome.toLowerCase().includes(buscaNome);
                return matchTipo && matchNome;
            });
            
            document.getElementById('totalPacientes').textContent = pacientesFiltrados.length;
            
            lista.innerHTML = pacientesFiltrados.map(paciente => {
                const tipoIcons = {
                    idoso: 'üë¥',
                    deficiencia: '‚ôø',
                    cronica: 'üè•',
                    rara: 'üî¨',
                    outros: 'üìã'
                };
                
                const idade = new Date().getFullYear() - new Date(paciente.nascimento).getFullYear();
                
                return `
                    <div class="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">${paciente.nome}</h3>
                                <p class="text-gray-600">${tipoIcons[paciente.tipoPaciente]} ${paciente.tipoPaciente.charAt(0).toUpperCase() + paciente.tipoPaciente.slice(1)} ‚Ä¢ ${idade} anos ‚Ä¢ ${paciente.tipoSanguineo}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="visualizarPaciente(${paciente.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                                    üëÅÔ∏è Ver
                                </button>
                                <button onclick="gerarQRCode(${JSON.stringify(paciente).replace(/"/g, '&quot;')})" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition-colors">
                                    üì± QR
                                </button>
                                <button onclick="excluirPaciente(${paciente.id})" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700 transition-colors">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <strong>Condi√ß√µes:</strong> ${paciente.condicoes || 'Nenhuma registrada'}
                            </div>
                            <div>
                                <strong>Contato:</strong> ${paciente.telefone}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Visualizar paciente
        function visualizarPaciente(id) {
            const paciente = pacientes.find(p => p.id === id);
            if (!paciente) return;
            
            const tipoIcons = {
                idoso: 'üë¥ Idoso',
                deficiencia: '‚ôø Pessoa com Defici√™ncia',
                cronica: 'üè• Doen√ßa Cr√¥nica',
                rara: 'üî¨ Doen√ßa Rara',
                outros: 'üìã Outros'
            };
            
            const idade = new Date().getFullYear() - new Date(paciente.nascimento).getFullYear();
            
            alert(`
üìã DADOS DO PACIENTE

üë§ Nome: ${paciente.nome}
üéÇ Idade: ${idade} anos
ü©∏ Tipo Sangu√≠neo: ${paciente.tipoSanguineo}
üì± Telefone: ${paciente.telefone}
üë• Tipo: ${tipoIcons[paciente.tipoPaciente]}

üè• INFORMA√á√ïES M√âDICAS:
‚Ä¢ Condi√ß√µes: ${paciente.condicoes || 'Nenhuma'}
‚Ä¢ Medicamentos: ${paciente.medicamentos || 'Nenhum'}
‚Ä¢ Alergias: ${paciente.alergias || 'Nenhuma'}
‚Ä¢ M√©dico: ${paciente.medico || 'N√£o informado'}

üö® EMERG√äNCIA:
‚Ä¢ Contato: ${paciente.contatoEmergencia || 'N√£o informado'}
‚Ä¢ Observa√ß√µes: ${paciente.observacoes || 'Nenhuma'}
            `);
        }

        // Excluir paciente
        function excluirPaciente(id) {
            if (confirm('Tem certeza que deseja excluir este paciente?')) {
                pacientes = pacientes.filter(p => p.id !== id);
                localStorage.setItem('pacientesMedicos', JSON.stringify(pacientes));
                atualizarLista();
            }
        }

        // Ler QR Code
        function lerQRCode() {
            const input = document.getElementById('qrInput').value.trim();
            if (!input) {
                alert('Por favor, cole os dados do QR Code.');
                return;
            }
            
            try {
                const dados = JSON.parse(input);
                exibirDadosLidos(dados);
            } catch (error) {
                alert('Dados do QR Code inv√°lidos. Verifique se copiou corretamente.');
            }
        }

        // Exibir dados lidos do QR
        function exibirDadosLidos(dados) {
            const container = document.getElementById('dadosLidos');
            const idade = new Date().getFullYear() - new Date(dados.nascimento).getFullYear();
            
            container.innerHTML = `
                <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg text-left">
                    <h3 class="text-xl font-bold text-red-800 mb-4">üö® INFORMA√á√ïES M√âDICAS DE EMERG√äNCIA</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üë§ Dados Pessoais</h4>
                            <p><strong>Nome:</strong> ${dados.nome}</p>
                            <p><strong>Idade:</strong> ${idade} anos</p>
                            <p><strong>Tipo Sangu√≠neo:</strong> <span class="bg-red-200 px-2 py-1 rounded font-bold">${dados.tipoSanguineo}</span></p>
                            <p><strong>Telefone:</strong> ${dados.telefone}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üö® Contato de Emerg√™ncia</h4>
                            <p class="bg-yellow-100 p-2 rounded">${dados.contatoEmergencia || 'N√£o informado'}</p>
                        </div>
                        
                        <div class="md:col-span-2">
                            <h4 class="font-semibold text-red-700 mb-2">‚ö†Ô∏è ALERGIAS</h4>
                            <p class="bg-red-100 p-3 rounded font-semibold">${dados.alergias || 'Nenhuma alergia conhecida'}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üè• Condi√ß√µes M√©dicas</h4>
                            <p>${dados.condicoes || 'Nenhuma condi√ß√£o registrada'}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üíä Medicamentos</h4>
                            <p>${dados.medicamentos || 'Nenhum medicamento registrado'}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üë®‚Äç‚öïÔ∏è M√©dico Respons√°vel</h4>
                            <p>${dados.medico || 'N√£o informado'}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">üìù Observa√ß√µes Especiais</h4>
                            <p>${dados.observacoes || 'Nenhuma observa√ß√£o'}</p>
                        </div>
                    </div>
                </div>
            `;
            
            container.classList.remove('hidden');
            container.classList.add('fade-in');
        }

        // Filtros da lista
        document.getElementById('filtroTipo').addEventListener('change', atualizarLista);
        document.getElementById('buscaNome').addEventListener('input', atualizarLista);

        // Inicializar
        showSection('cadastro');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964d537ae6868125',t:'MTc1MzQ2NDAwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
